<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Mount Specs | Litho</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/codegen/mount-specs/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Mount Specs | Litho"><meta data-react-helmet="true" name="description" content="A mount spec defines a component that can render views or drawables."><meta data-react-helmet="true" property="og:description" content="A mount spec defines a component that can render views or drawables."><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/codegen/mount-specs/"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/codegen/mount-specs/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/codegen/mount-specs/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.500f1454.css">
<link rel="preload" href="/assets/js/runtime~main.c0c9427e.js" as="script">
<link rel="preload" href="/assets/js/main.4058c681.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="color:#091E42" role="banner"><div class="announcementBarContent_3EUC">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine">Help Provide Humanitarian Aid to Ukraine</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation/">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview/">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What is Litho?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Main Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Building lists</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Animations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Visibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Accessibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Widgets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Adopting Litho</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Codegen APIs</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/overview/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/layout-specs/">Layout Specs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/codegen/mount-specs/">Mount Specs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Passing Data To Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/state-for-specs/">State in Specs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/events-for-specs/">Events for Specs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/trigger-events/">Triggering Events with Handles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/code-generation/">Code generation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tooling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">Mount Specs</h1></header><div class="markdown"><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>A <em>mount spec</em> defines a component that can render views or drawables.</p></div></div><p>Mount specs should only be created when you need to integrate your own views/drawables with Litho. Here, <em>Mount</em> refers to the operation performed by all components in a layout tree to extract their rendered state (a <code>View</code> or a <code>Drawable</code>) to be displayed.</p><p>Mount spec classes should be annotated with <code>@MountSpec</code> and implement at least an <code>@OnCreateMountContent</code> method. The other methods listed below are  optional.</p><p>The lifecycle of mount spec components is as follows:</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li><code>BG</code>- occurs on a background (BG) thread when possible. Do not modify the view hierarchy.</li><li><code>UI</code> - can occur on UI thread.</li><li><code>PC</code> - Performance critical. Put as little work in it as possible, use <code>BG</code> methods instead.</li></ul></div></div><ol><li>Run <code>@OnPrepare</code> once, before the layout calculation <!-- -->[<code>BG</code>/<code>UI</code>]<!-- -->.</li><li>Run <code>@OnMeasure</code> optionally during layout calculation. This will <strong>not</strong> be called if Yoga has already determined your component&#x27;s bounds (for example, a static width/height was set on the component) <!-- -->[<code>BG</code>/<code>UI</code>]<!-- -->.</li><li>Run <code>@OnBoundsDefined</code> once, after layout calculation. This will be called whether or not <code>@OnMeasure</code> was called <!-- -->[<code>BG</code>/<code>UI</code>]<!-- -->.</li><li>Run <code>@OnCreateMountContent</code> before the component is attached to a hosting view. This content may be reused for other instances of this component. <strong>It must not return null</strong> <!-- -->[<code>UI</code>]<!-- -->.</li><li>Run <code>@OnMount</code> before the component is attached to a hosting view. This will happen when the component is about to become visible when incremental mount is enabled (it is enabled by default) <!-- -->[<code>UI</code>/<code>PC</code>]<!-- -->.</li><li>Run <code>@OnBind</code> after the component is attached to a hosting view <!-- -->[<code>UI</code>/<code>PC</code>]<!-- -->.</li><li>Run <code>@OnUnbind</code> before the component is detached from a hosting view <!-- -->[<code>UI</code>/<code>PC</code>]<!-- -->.</li><li>Run <code>@OnUnmount</code> optionally after the component is detached from a hosting view. See incremental mount notes on <code>@OnMount</code>: they apply in reverse here <!-- -->[<code>UI</code>/<code>PC</code>]<!-- -->.</li></ol><h2 class="anchor anchorWithStickyNavbar_31ik" id="mounting">Mounting<a aria-hidden="true" class="hash-link" href="#mounting" title="Direct link to heading">â€‹</a></h2><p>The following code snippet starts with a simple <code>ColorComponent</code> that takes a color name as a prop and mounts its respective <code>ColorDrawable</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@MountSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ColorComponentSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateMountContent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static ColorDrawable onCreateMountContent(Context context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new ColorDrawable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnMount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onMount(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ColorDrawable colorDrawable,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @Prop String colorName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    colorDrawable.setColor(Color.parseColor(colorName));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Within the above code snippet:</p><ul><li>The mount operation has an API very similar to Android&#x27;s <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.Adapter.html" target="_blank" rel="noopener noreferrer">RecyclerView Adapters</a>. It has a <code>onCreateMountContent</code> method to create and initialize the <code>View</code>/<code>Drawable</code> content if the recycling pool is empty, and an <code>onMount</code> method to update the recycled content with the current information.</li><li>The return type from <code>onCreateMountContent</code> should always match the type of the second argument of <code>onMount</code>. They are required to be a <code>View</code> or a <code>Drawable</code> subclass. This is validated by the annotation processor at build time.</li><li>Mounting always happens in the main thread as it might have to deal with Android Views (which are bound to the main thread).</li><li><code>onCreateMountContent</code> cannot take a <code>@Prop</code> or any other annotated parameter.</li><li>Given that the <code>@OnMount</code> method always runs in the UI thread, expensive operations should not be performed in it.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="inter-stage-inputs-and-outputs">Inter-stage inputs and outputs<a aria-hidden="true" class="hash-link" href="#inter-stage-inputs-and-outputs" title="Direct link to heading">â€‹</a></h2><p>You can move heavy operations off the UI thread by performing them in the <code>@OnPrepare</code> method, which runs only once before the layout calculation is performed and can be executed in a background thread.</p><p>If you want to perform the color name parsing off the UI thread in the <code>ColorComponent</code> above then you need a way to pass values generated in the <code>@OnPrepare</code> method to the <code>@OnMount</code> implementation. Litho provides &#x27;inter-stage inputs and outputs&#x27; to enable you to do exactly that.</p><p>The following snippet uses a <code>ColorComponent</code> with the described <code>@OnPrepare</code> method:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@MountSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ColorComponentSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnPrepare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onPrepare(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @Prop String colorName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Output&lt;Integer&gt; color) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    color.set(Color.parseColor(colorName));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateMountContent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static ColorDrawable onCreateMountContent(Context context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new ColorDrawable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnMount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onMount(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ColorDrawable colorDrawable,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromPrepare int color) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    colorDrawable.setColor(color);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Using <code>Output&lt;?&gt;</code> in any of the <code>@MountSpec</code> methods automatically creates an input for the following stages. In this case, an <code>@OnPrepare</code> output creates an input for <code>@OnMount</code>.</p><p>The annotation processor will ensure inter-stage invariants are respected at build time. For example, you cannot use outputs from <code>@OnMeasure</code> in <code>@OnPrepare</code> as <code>@OnPrepare</code> always runs before <code>@OnMeasure</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="measurement">Measurement<a aria-hidden="true" class="hash-link" href="#measurement" title="Direct link to heading">â€‹</a></h2><p>You should implement an <code>@OnMeasure</code> method whenever you want to define how your component should be measured during the layout calculation.</p><p>The following assigns the <code>ColorComponent</code> a default width and enforces a certain aspect ratio when its height is undefined.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnMeasure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void onMeasure(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ComponentLayout layout,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int widthSpec,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int heightSpec,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Size size) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // If width is undefined, set default size.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (SizeSpec.getMode(widthSpec) == SizeSpec.UNSPECIFIED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size.width = 40;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size.width = SizeSpec.getSize(widthSpec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // If height is undefined, use 1.5 aspect ratio.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (SizeSpec.getMode(heightSpec) == SizeSpec.UNSPECIFIED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size.height = size.width * 1.5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size.height = SizeSpec.getSize(heightSpec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can access component props with the <code>@Prop</code> annotation as usual in <code>@OnMeasure</code>. SizeSpec&#x27;s API is analogous to Android&#x27;s <a href="http://developer.android.com/reference/android/view/View.MeasureSpec.html" target="_blank" rel="noopener noreferrer">MeasureSpec</a>.</p><p>Just like <code>@OnPrepare</code>, the <code>@OnMeasure</code> method can also generate inter-stage outputs (accessible via the <code>@FromMeasure</code> argument annotation) and may be performed in a background thread.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="shouldupdate">ShouldUpdate<a aria-hidden="true" class="hash-link" href="#shouldupdate" title="Direct link to heading">â€‹</a></h2><p>A MountSpec can define a method annotated with <code>@ShouldUpdate</code> to avoid remeasuring and remounting upon updates.</p><p>Invocations of <code>@ShouldUpdate</code> are dependent on whether a Component is a <strong>pure render function</strong>. A Component is a pure render function if the result of the rendering only depends on its props and states. This means that the Component shouldn&#x27;t be accessing any mutable global variable during <code>@OnMount</code>.</p><p>A <code>@MountSpec</code> can be defined as pure render by using the pureRender parameter of the <code>@MountSpec</code> annotation.</p><p>Only pure render components can assume that when props do not change remounting won&#x27;t be needed. A <code>@ShouldUpdate</code> function can be defined as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@ShouldUpdate(onMount = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static boolean shouldUpdate(@Prop Diff&lt;String&gt; someStringProp) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return !someStringProp.getPrevious().equals(someStringProp.getNext());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The parameters taken from <code>shouldUpdate</code> are <a href="/javadoc/com/facebook/litho/Diff.html" target="_blank" rel="noopener noreferrer">Diffs</a> of Props or State. A Diff is an object containing the value of a <code>@Prop</code> or a <code>@State</code> in the old component&#x27;s hierarchy and the value of the same <code>@Prop</code> or <code>@State</code> in the new component&#x27;s hierarchy.</p><p>Within the above snippet:</p><ul><li>The component defines <strong>someStringProp</strong> as a String <code>@Prop</code>. <code>shouldUpdate</code> receives a <code>Diff&lt;String&gt;</code> to be able to compare the old and new value of this <code>@Prop</code>.</li><li><code>shouldUpdate</code> has to take into consideration any prop and any states that are used at <code>@OnMount</code> time. It can safely ignore props and states that are only used at <code>@OnBind</code>/<code>@OnUnbind</code> time as these two methods will be executed regardless.</li><li>The <code>onMount</code> attribute on the <code>@ShouldUpdate</code> annotation controls whether this <code>shouldUpdate</code> check can happen at mount time. By default, Litho will try to do this reconciliation at layout time, but if layout diffing is turned off it might be useful to set onMount to true in order to execute this check at mount time instead. The <code>onMount</code> attribute is set to false by default as the equality check might be heavy itself and make mount performances worse.</li><li><code>ShouldUpdate</code> annotated methods are currently only supported in <code>@MountSpec</code>. There are plans to expand the support to complex layouts in the future but at the moment a <code>@ShouldUpdate</code> annotated method in a <code>@LayoutSpec</code> would have no effect.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="pre-allocation">Pre-allocation<a aria-hidden="true" class="hash-link" href="#pre-allocation" title="Direct link to heading">â€‹</a></h2><p>When a MountSpec component is being mounted, its <code>View</code>/<code>Drawable</code> content needs to be either initialized or reused from the recycling pool. If the pool is empty, a new instance will be created at that time, which might keep the UI thread too busy and drop one or more frames. To mitigate that, Litho can pre-allocate a few instances and put in the recycling pool:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@MountSpec(poolSize = 3, canPreallocate = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ColorComponentSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>canPreallocate</code> enables pre-allocation for this MountSpec and <code>poolSize</code> defines the number of instances to pre-allocate. For this <code>ColorComponent</code> example, three instances of <code>ColorDrawable</code> will be created and put in the recycling pool. This option is recommended for MountSpec components that inflate a complex <code>View</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/codegen/mount-specs.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/codegen/layout-specs/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Layout Specs</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/codegen/passing-data-to-components/spec-props/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Props in Specs<!-- --> Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mounting" class="table-of-contents__link toc-highlight">Mounting</a></li><li><a href="#inter-stage-inputs-and-outputs" class="table-of-contents__link toc-highlight">Inter-stage inputs and outputs</a></li><li><a href="#measurement" class="table-of-contents__link toc-highlight">Measurement</a></li><li><a href="#shouldupdate" class="table-of-contents__link toc-highlight">ShouldUpdate</a></li><li><a href="#pre-allocation" class="table-of-contents__link toc-highlight">Pre-allocation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing/">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c0c9427e.js"></script>
<script src="/assets/js/main.4058c681.js"></script>
</body>
</html>