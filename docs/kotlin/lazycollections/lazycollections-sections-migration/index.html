<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Sections Migration Guide | Litho</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/kotlin/lazycollections/lazycollections-sections-migration/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Sections Migration Guide | Litho"><meta data-react-helmet="true" name="description" content="This page provides guidance for migrating an existing list rendered with Sections to lazy collections. This will involve:"><meta data-react-helmet="true" property="og:description" content="This page provides guidance for migrating an existing list rendered with Sections to lazy collections. This will involve:"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/kotlin/lazycollections/lazycollections-sections-migration/"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/kotlin/lazycollections/lazycollections-sections-migration/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/kotlin/lazycollections/lazycollections-sections-migration/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.500f1454.css">
<link rel="preload" href="/assets/js/runtime~main.9d413ff5.js" as="script">
<link rel="preload" href="/assets/js/main.ddc73d99.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="color:#091E42" role="banner"><div class="announcementBarContent_3EUC">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine">Help Provide Humanitarian Aid to Ukraine</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation/">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview/">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">Sections Migration Guide</h1></header><div class="markdown"><p>This page provides guidance for migrating an existing list rendered with Sections to <a href="/docs/kotlin/lazycollections/lazycollections/">lazy collections</a>. This will involve:</p><ol><li>Replacing the component that renders the section tree with a lazy collection component.</li><li>Adding each component from the section tree as a child of the lazy collection.</li><li>Migrating any event handlers or state.</li></ol><p>Lazy Collections offer a cleaner API for building scrolling lists. Advantages over Sections include:</p><ul><li>No code generation.</li><li>Simple inline declaration (similar to a Row/Column).</li><li>List items have direct access to the containing components props and state.</li><li>Automatic diffing of content updates.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="replace-the-recyclercollectioncomponent">Replace the <code>RecyclerCollectionComponent</code><a aria-hidden="true" class="hash-link" href="#replace-the-recyclercollectioncomponent" title="Direct link to heading">â€‹</a></h2><p>Sections are typically rendered by a <code>RecyclerCollectionComponent</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val component = RecyclerCollectionComponent.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .section(...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .build()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This should be replaced with a lazy collection component, for example <code>LazyList</code>. For information on migrating the <code>RecyclerCollectionComponent</code>&#x27;s configuration options, see the <a href="/docs/kotlin/lazycollections/lazycollections-layout/">Layout and Styling</a> page.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val component = LazyList {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Content will be added inline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Lazy collections can only be used inside <code>KComponent</code>s. If you are migrating a Spec component then first convert it to a <code>KComponent</code> or implement the lazy collection inside a <code>KComponent</code> container.</p></div></div><p>Next, you need to migrate the content from the Section into the lazy collection, as detailed below.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="migrating-groupsectionspec">Migrating <code>GroupSectionSpec</code><a aria-hidden="true" class="hash-link" href="#migrating-groupsectionspec" title="Direct link to heading">â€‹</a></h2><p>A <code>GroupSectionSpec</code> includes an <code>onCreateChildren</code> function that creates a list of <code>SingleComponentSection</code> and <code>DataDiffSection</code> children.</p><p>The first step is to migrate each <code>SingleComponentSection</code>. The following <code>GroupSectionSpec</code> renders two components as <code>SingleComponentSection</code>s:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@GroupSectionSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object SimpleGroupSectionSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateChildren</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun onCreateChildren(c: SectionContext, @Prop title: String): Children =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Children.create()</span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">          .child(SingleComponentSection.create(c).component(Text.create(c).text(title).build()))</span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">          .child(SingleComponentSection.create(c).component(MyComponent.create(c).build()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The component from each <code>SingleComponentSection</code> should be added as a child to the lazy collection. Lazy collections supports <code>KComponent</code> and <code>Spec</code> children. <code>SingleComponentSection</code> config options are available as parameters on child, such as <code>isSticky</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class SimpleGroupMigration(private val title: String) : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component = LazyList {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add SingleComponentSection components as children:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    child(Text(title))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    child(MyComponent.create(context).build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Next, consider a list rendered with a <code>DataDiffSection</code></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="migrating-datadiffsection">Migrating <code>DataDiffSection</code><a aria-hidden="true" class="hash-link" href="#migrating-datadiffsection" title="Direct link to heading">â€‹</a></h2><p>A <code>DataDiffSection</code> defines how a list should be rendered. They can be defined as a child in a <code>GroupSectionSpec</code>, or directly on a <code>RecyclerCollectionComponent</code>, and require the following event handlers:</p><ul><li><code>renderEventHandler</code> - render a list item.</li><li><code>onCheckIsSameItemEventHandler</code>  - Used to determine if items have the same identity.</li><li><code>onCheckIsSameContentEventHandler</code> - Used to determine if items have updated content.</li></ul><p>Consider the following <code>GroupSectionSpec</code> that contains a <code>DataDiffSection</code> to render a list of the following type:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class Model(val id: String, val field1: String, val field2: String)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@GroupSectionSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object ListSectionSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateChildren</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun onCreateChildren(c: SectionContext, @Prop data: List&lt;Model&gt;): Children =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Children.create()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              DataDiffSection.create&lt;Model&gt;(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .data(data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .renderEventHandler(ListSection.onRenderItem(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .onCheckIsSameItemEventHandler(ListSection.onCheckIsSameItem(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .onCheckIsSameContentEventHandler(ListSection.onCheckIsSameContent(c)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(RenderEvent::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun onRenderItem(c: SectionContext, @FromEvent model: Model): RenderInfo =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentRenderInfo.create()</span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">          .component(Text.create(c).text(&quot;${model.field1} ${model.field2}&quot;).build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(OnCheckIsSameItemEvent::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun onCheckIsSameItem(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      c: SectionContext,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent previousItem: Model,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent nextItem: Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): Boolean =</span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">      previousItem.id == nextItem.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(OnCheckIsSameContentEvent::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun onCheckIsSameContent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sectionContext: SectionContext,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent previousItem: Model,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent nextItem: Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): Boolean = previousItem.field1 == nextItem.field1 &amp;&amp; previousItem.field2 == nextItem.field2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A component for each list item should be added the lazy collection as a child. The component can be copied from the RenderEventâ€™s <code>ComponentRenderInfo</code> <code>component</code> parameter.</p><p>The child <code>id</code> parameter should be a unique and consistent across renders and will likely be the value that is compared in <code>onCheckIsSameItem</code>. See the <a href="/docs/kotlin/lazycollections/lazycollections-working-with-updates/#child-identity">guidelines for child ids</a>.</p><p>It is not necessary to migrate the checks from <code>onCheckIsSameContent</code> as the lazy collection will automatically compare the child component props. However, additional steps may be required to eliminate unnecessary layouts if child takes props that do not provide an <code>equals()</code>. For more information, see the <a href="/docs/kotlin/lazycollections/lazycollections-working-with-updates/##avoiding-unecessary-layouts">Avoiding Unnecessary Layouts</a> page.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class ListMigration(private val data: List&lt;Model&gt;) : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component = LazyList {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add DataDiffSection contents as children with ids</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    children(items = data, id = { it.id }) { Text(&quot;${it.field1} ${it.field2}&quot;) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="migrating-event-handlers">Migrating Event Handlers<a aria-hidden="true" class="hash-link" href="#migrating-event-handlers" title="Direct link to heading">â€‹</a></h2><p>Event handlers that are defined as <code>@OnEvent</code> function (such as visibility or click handling) can be passed as lambdas to the appropriate Style function. Note that using lambdas as props could cause <a href="/docs/kotlin/lazycollections/lazycollections-working-with-updates/#using-lambdas-as-props">unnecessary updates</a>, so they should be wrapped in a <code>useCallback</code> hook.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@GroupSectionSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object EventHandlerSectionSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateChildren</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun onCreateChildren(c: SectionContext): Children =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Children.create()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              SingleComponentSection.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .component(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Text.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          .text(&quot;Say Hello&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          .clickHandler(EventHandlerSection.onClick(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          .build()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(ClickEvent::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun onClick(c: SectionContext) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    println(&quot;Hello World!&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Migrating the above Section to a lazy collection&#x27;s yields:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class EventHandlerMigration : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val onClick = useCallback { _: ClickEvent -&gt; println(&quot;Hello World!&quot;) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return LazyList {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Using Style.onClick(..)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      child(Text(&quot;Say Hello&quot;, style = Style.onClick(onClick)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Or using the Spec api with eventHandler(..)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      child(Text.create(context).text(&quot;Say Hello&quot;).clickHandler(eventHandler(onClick)).build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="migrating-section-state">Migrating Section State<a aria-hidden="true" class="hash-link" href="#migrating-section-state" title="Direct link to heading">â€‹</a></h2><p>State managed by a <code>Section</code> should be moved into the component that manages the lazy collection. You may consider defining your lazy collection inside a dedicated <code>KComponent</code> so that it can maintain its own state.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@GroupSectionSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object StateSectionSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateInitialState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun createInitialState(c: SectionContext, counter: StateValue&lt;Int&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    counter.set(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateChildren</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun onCreateChildren(c: SectionContext, @State counter: Int): Children =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Children.create()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              SingleComponentSection.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .component(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Text.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          .text(&quot;Increment: $counter&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          .clickHandler(StateSection.onClick(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          .build()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(ClickEvent::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun onClick(c: SectionContext) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StateSection.incrementCounter(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnUpdateState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun incrementCounter(counter: StateValue&lt;Int&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    counter.set((counter.get() ?: 0) + 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Migrating the above Section to a lazy collections yields:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class StateMigration : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val counter = useState { 0 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val onClick = useCallback { _: ClickEvent -&gt; counter.update { it + 1 } }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return LazyList { child(Text(&quot;Increment ${counter.value}&quot;, style = Style.onClick(onClick))) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/kotlin/lazycollections/lazycollections-sections-migration.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#replace-the-recyclercollectioncomponent" class="table-of-contents__link toc-highlight">Replace the <code>RecyclerCollectionComponent</code></a></li><li><a href="#migrating-groupsectionspec" class="table-of-contents__link toc-highlight">Migrating <code>GroupSectionSpec</code></a></li><li><a href="#migrating-datadiffsection" class="table-of-contents__link toc-highlight">Migrating <code>DataDiffSection</code></a></li><li><a href="#migrating-event-handlers" class="table-of-contents__link toc-highlight">Migrating Event Handlers</a></li><li><a href="#migrating-section-state" class="table-of-contents__link toc-highlight">Migrating Section State</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing/">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9d413ff5.js"></script>
<script src="/assets/js/main.ddc73d99.js"></script>
</body>
</html>