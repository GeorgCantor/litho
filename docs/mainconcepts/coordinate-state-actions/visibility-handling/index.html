<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Handling Visibility | Litho</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/visibility-handling/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Handling Visibility | Litho"><meta data-react-helmet="true" name="description" content="Describes the APIs to handle visibility of components"><meta data-react-helmet="true" property="og:description" content="Describes the APIs to handle visibility of components"><meta data-react-helmet="true" name="keywords" content="visibility,visible,invisible,focus"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/visibility-handling/"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/visibility-handling/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/visibility-handling/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.500f1454.css">
<link rel="preload" href="/assets/js/runtime~main.c0c9427e.js" as="script">
<link rel="preload" href="/assets/js/main.4058c681.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="color:#091E42" role="banner"><div class="announcementBarContent_3EUC">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine">Help Provide Humanitarian Aid to Ukraine</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation/">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview/">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What is Litho?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Main Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Building lists</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Animations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Visibility</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/visibility-handling/">Handling Visibility</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Accessibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Widgets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Adopting Litho</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Codegen APIs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tooling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">Handling Visibility</h1></header><div class="markdown"><p>Litho provides predefined APIs to support a range of use cases where components require callbacks when the on-screen position relative to the visible viewport changes.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="types-of-visibility-callbacks">Types of Visibility Callbacks<a aria-hidden="true" class="hash-link" href="#types-of-visibility-callbacks" title="Direct link to heading">â€‹</a></h2><p>The framework currently supports six types of Visibility callbacks:</p><ul><li><a href="/javadoc/com/facebook/litho/VisibleEvent.html" target="_blank" rel="noopener noreferrer">Visible</a>: Invoked when at least 1 pixel of the Component is visible. If the component mounts some content, then the <code>event.content</code>
will be a reference to that content.</li><li><a href="/javadoc/com/facebook/litho/InvisibleEvent.html" target="_blank" rel="noopener noreferrer">Invisible</a>: Invoked when the Component no longer has any pixels on the screen.</li><li><a href="/javadoc/com/facebook/litho/FocusedVisibleEvent.html" target="_blank" rel="noopener noreferrer">Focused</a>: Invoked when either the Component occupies at least 50% of the viewport or if the Component is smaller than half the viewport, when it is fully visible.</li><li><a href="/javadoc/com/facebook/litho/UnfocusedVisibleEvent.html" target="_blank" rel="noopener noreferrer">Unfocused</a>: Invoked when the Component is no longer focused, such as if it&#x27;s not fully visible and does not occupy at least half the viewport.</li><li><a href="/javadoc/com/facebook/litho/FullImpressionVisibleEvent.html" target="_blank" rel="noopener noreferrer">Full Impression</a>: If the Component is smaller than the viewport, this callback is invoked when the entire Component is visible in the viewport. If the Component is bigger than the viewport, then just covering the viewport won&#x27;t invoke this callback: it will be invoked when all the edges have passed through the viewport once.</li><li><a href="/javadoc/com/facebook/litho/VisibilityChangedEvent.html" target="_blank" rel="noopener noreferrer">Visibility Changed</a>: Invoked when the visible bounds of the Component change. The event object will tell you the visible top and left coordinate, and the current visible width and height of the content.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="usage">Usage<a aria-hidden="true" class="hash-link" href="#usage" title="Direct link to heading">â€‹</a></h2><p>The following example illustrates setting visibility callbacks on a component:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class VisibilityHandlingExampleComponent : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        style =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Style.onVisible { event -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  // If the handler was set on a component which mounts content then the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  // event.content will be a reference to the mounted content.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  if (event.content is View) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    log(&quot;Visible&quot;, &quot;View&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    log(&quot;Visible&quot;, &quot;Drawable&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .onInvisible { log(&quot;Invisible&quot;, &quot;null&quot;) }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      child(Text(&quot;hello world&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Row(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              style =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  Style.onVisibilityChanged { event -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (event.percentVisibleHeight &gt; 50) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Log.d(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          &quot;visibility-changed&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          &quot;View is mostly visible now. With: &quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &quot;\ntop: ${event.visibleTop}&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &quot;\nleft: ${event.visibleLeft}&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &quot;\nvisible width: ${event.visibleWidth}&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &quot;\nvisible height: ${event.visibleHeight}&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &quot;\npercentage visible height: ${event.percentVisibleHeight}&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &quot;\npercentage visible width: ${event.percentVisibleWidth}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  }) { child(Text(&quot;This is an example.&quot;)) })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun log(type: String, content: String) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Log.d(&quot;visibility&quot;, &quot;Visibility callback: $type content: $content&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Visibility change callbacks should be used with particular care since they are invoked on every frame while scrolling. No heavy work should be done inside the visibility changed callbacks. &#x27;Visible&#x27;, &#x27;Invisible&#x27;, &#x27;Focused&#x27;, &#x27;Unfocused&#x27;, and &#x27;Full Impression&#x27; are recommended over visibility changed whenever possible.</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="custom-visibility-percentage">Custom visibility percentage<a aria-hidden="true" class="hash-link" href="#custom-visibility-percentage" title="Direct link to heading">â€‹</a></h3><p>By default, <code>VisibleEvent</code> is triggered when at least 1 pixel of the Component is visible. In some cases, you may want to listen to custom visibility changes and perform an action when the Component is only partially visible. You can specify a ratio of the Component width or height for the visibility callback to be dispatched by using <code>visibleHeightRatio</code> and <code>visibleWidthRatio</code> props when specifying a visibility handler.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Currently, the Kotlin API does not expose <code>visibleHeightRatio</code> and <code>visibleWidthRatio</code>. Please use the Codengen APIs if you need to leverage that.</p></div></div><p>For the example above, a Visibility Event is dispatched when at least 80% of the Component&#x27;s height and 10% of the Component&#x27;s width is visible. When the Component&#x27;s visible percentage changes to less than 80% of total height, an invisible event will be dispatched. If not specified, the default width or height ratio is 1f.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="changing-lithoview-visibility">Changing LithoView Visibility<a aria-hidden="true" class="hash-link" href="#changing-lithoview-visibility" title="Direct link to heading">â€‹</a></h2><p>There are cases when the visibility callback needs to be invoked on the LithoView components because the LithoView&#x27;s visibility changed but did not receive any callbacks to inform it of this change.
For example, when an activity is added to the back stack, covering the current UI. For such cases, Litho provides the <a href="#litholifecycleprovider-api">LithoLifecycleProvider API</a> to notify LithoView about changes in its visibility, and to dispatch correct events to components inside.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="litholifecycleprovider-api">LithoLifecycleProvider API<a aria-hidden="true" class="hash-link" href="#litholifecycleprovider-api" title="Direct link to heading">â€‹</a></h3><p>The <code>LithoLifecycleProvider</code> API can be used to inform LithoView about  changes in its visibility state.</p><p>The <code>LithoLifecycleProvider.moveToLifecycle()</code> method should be called from the <code>Fragment.setUserVisibleHint()</code> or <code>onResume()/onPause()</code> methods of <code>Activity</code> or <code>Fragment</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public interface LithoLifecycleProvider {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Should be called to inform Litho that its visibility state has changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void moveToLifecycle(LithoLifecycle lithoLifecycle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="valid-litholifecycleprovider-states">Valid LithoLifecycleProvider states:<a aria-hidden="true" class="hash-link" href="#valid-litholifecycleprovider-states" title="Direct link to heading">â€‹</a></h4><ul><li><p><code>HINT_INVISIBLE</code> - indicates that the lifecycle provider is considered to be not visible on screen. Lifecycle observers can perform operations that are associated with invisibility status.
An example of moving to a <code>HINT_INVISIBLE</code> state is when a fragment goes from <strong>Resumed</strong> to <strong>Paused</strong> because the app was backgrounded. The <strong>invisible</strong> events will be dispatched to all Components inside the <code>LithoView</code> that were visible.</p></li><li><p><code>HINT_VISIBLE</code> - indicates that the lifecycle provider is considered visible on screen.
Lifecycle observers can perform operations that are associated with visibility status. An example of moving to <code>HINT_VISIBLE</code> state is when a fragment goes from <strong>Paused</strong> to <strong>Resumed</strong> because the app was foregrounded. <strong>Visible </strong> events will be dispatched to all Components inside the <code>LithoView</code> which meet the visibility criteria.</p></li><li><p><code>DESTROYED</code> - the final state of a lifecycle provider. Lifecycle observers can perform operations associated with releasing resources. An example of moving to <code>DESTROYED</code> state is when the hosting Activity is destroyed. The <code>ComponentTree</code> associated with the <code>LithoView</code> will be released; all the <strong>invisible</strong> events will be dispatched to all Components that were visible, and all content will be unmounted.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_31ik" id="listening-to-a-litholifecycleprovider-state-changes">Listening to a <code>LithoLifecycleProvider</code> state changes:<a aria-hidden="true" class="hash-link" href="#listening-to-a-litholifecycleprovider-state-changes" title="Direct link to heading">â€‹</a></h4><p>You can register a <code>LithoView</code> to listen to state changes of a <code>LithoLifecycleProvider</code> instance when you create it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">final LithoView lithoView = LithoView.create(c, component, lithoLifecycleProvider);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="android-aosp-implementation">Android AOSP implementation<a aria-hidden="true" class="hash-link" href="#android-aosp-implementation" title="Direct link to heading">â€‹</a></h3><p>This is an implementation of <code>LithoLifecycleProvider</code> which has the state tied to that of an AOSP <a href="https://developer.android.com/topic/libraries/architecture/lifecycle#lco" target="_blank" rel="noopener noreferrer">LifecycleOwner</a>.</p><ul><li><code>LifecycleOwner</code> in <code>ON_PAUSE</code> state moves the <code>AOSPLithoLifecycleProvider</code> to <code>HINT_INVISIBLE</code> state</li><li><code>LifecycleOwner</code> in <code>ON_RESUME</code> state moves the <code>AOSPLithoLifecycleProvider</code> to <code>HINT_VISIBLE</code> state</li><li><code>LifecycleOwner</code> in <code>ON_DESTROY</code> state moves the <code>AOSPLithoLifecycleProvider</code> to <code>DESTROYED</code> state</li></ul><p>Use <code>AOSPLithoLifecycleProvider</code> when you want to associate a LithoView&#x27;s visibility status with the lifecycle of a Fragment, Activity or custom LifecycleOwner, where <strong>Resumed</strong> means the LithoView is on screen and <strong>Paused</strong> means the LithoView is hidden.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val lifecycleProvider = AOSPLithoLifecycleProvider(this)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val componentContext = ComponentContext(this)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lithoView =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LithoView.create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LifecycleDelegateComponent.create(componentContext)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .id(atomicId.getAndIncrement().toString())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .delegateListener(delegateListener)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .consoleDelegateListener(consoleDelegateListener)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lifecycleProvider /* The LithoLifecycleProvider for this LithoView */)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="handling-custom-state-changes">Handling custom state changes<a aria-hidden="true" class="hash-link" href="#handling-custom-state-changes" title="Direct link to heading">â€‹</a></h3><p><code>AOSPLithoLifecycleProvider</code> covers most of the common cases, but there are scenarios where a LifecycleOwner&#x27;s state doesn&#x27;t match what we see on screen, as shown in the following examples:</p><ul><li><p>Fragments in a ViewPager, where Fragments for the previous and next pages are prepared and in a <strong>Resumed</strong> state before they&#x27;re actually visible.</p></li><li><p>Adding a Fragment on top of another Fragment doesn&#x27;t move the first Fragment to a <strong>Paused</strong> state, and there&#x27;s no indication that it&#x27;s no longer visible to the user.</p></li></ul><p>When you need to handle these state changes manually, you can use <code>LithoLifecycleProviderDelegate</code>, a generic <code>LithoLifecycleProvider</code> implementation, to change state when appropriate.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="viewpager-example">ViewPager example<a aria-hidden="true" class="hash-link" href="#viewpager-example" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private val delegate = LithoLifecycleProviderDelegate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">override fun setUserVisibleHint(isVisibleToUser: Boolean) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  super.setUserVisibleHint(isVisibleToUser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (wasVisible == isVisibleToUser) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (isVisibleToUser) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wasVisible = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delegate.moveToLifecycle(LithoLifecycleProvider.LithoLifecycle.HINT_VISIBLE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wasVisible = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delegate.moveToLifecycle(LithoLifecycleProvider.LithoLifecycle.HINT_INVISIBLE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">override fun onCreateView(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inflater: LayoutInflater,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container: ViewGroup?,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    savedInstanceState: Bundle?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">): View {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val parent = inflater.inflate(R.layout.screen_slide_fragment, container, false) as ViewGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val c = ComponentContext(requireContext())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lithoView =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      LithoView.create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          getComponent(c),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          delegate /* The LithoLifecycleProvider delegate for this LithoView */)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="fragment-transaction-example">Fragment Transaction example<a aria-hidden="true" class="hash-link" href="#fragment-transaction-example" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private val delegate: LithoLifecycleProviderDelegate = LithoLifecycleProviderDelegate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">override fun onClick(view: View) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Replaces the current fragment with a new fragment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replaceFragment()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // inform the LithoView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  delegate.moveToLifecycle(LithoLifecycleProvider.LithoLifecycle.HINT_VISIBLE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">override fun onCreateView(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inflater: LayoutInflater,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container: ViewGroup?,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    savedInstanceState: Bundle?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">): View {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val parent =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      inflater.inflate(R.layout.activity_fragment_transactions_lifecycle, container, false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          as ViewGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val c = ComponentContext(requireContext())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lithoView =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      LithoView.create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          getComponent(c),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          delegate /* The LithoLifecycleProvider delegate for this LithoView */)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="nested-component-trees">Nested Component Trees<a aria-hidden="true" class="hash-link" href="#nested-component-trees" title="Direct link to heading">â€‹</a></h3><p>The Litho components for building Lists (<code>Section</code>s, <code>VerticalScrollSpec</code>, <code>HorizontalScrollSpec</code>) create hierarchies of nested <code>ComponentTree</code>s:</p><ul><li>A ComponentTree at the root of the hierarchy, encapsulating the entire list (associated with a root LithoView)</li><li>A ComponentTree for each item in the List (associated with a LithoView child of the root LithoView)</li></ul><p>If the root LithoView is subscribed to listen to a <code>LithoLifecycleProvider</code>, then all nested Component Trees / child LithoViews will listen to the outer <code>LithoLifecycleProvider</code> too and will receive the correct information about visibility/destroyed state.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The section below contains information about deprecated APIs. Please consider using <code>LithoLifecycleProvider</code> for manually informing a <code>LithoView</code> about visibility changes.</p></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="deprecated-setvisibilityhint">(Deprecated) setVisibilityHint<a aria-hidden="true" class="hash-link" href="#deprecated-setvisibilityhint" title="Direct link to heading">â€‹</a></h2><p>After calling <code>LithoView.setVisibilityHint(false)</code>, the LithoView will consider itself not visible and will ignore any requests to mount until <code>setVisibilityHint(true)</code> is called.
You may still unmount the entire LithoView content by calling <code>unmountAll</code> if the visibility hint was set to false.</p><p>Resetting the visibility hint to true after it was set to false will also trigger a mount pass, in case the visible bounds changed while the LithoView was ignoring mount requests.</p><p>Example usage:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// To dispatch visible/focused events as necessary on all components inside this LithoView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LithoView.setVisibilityHint(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// To dispatch invisible/unfocused events as necessary on all components inside this LithoView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LithoView.setVisibilityHint(false);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/mainconcepts/coordinate-state-actions/visibility-handling.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/animations/dynamic-props/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Animating View Properties with Dynamic Props</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/accessibility/accessibility-overview/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview<!-- --> Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#types-of-visibility-callbacks" class="table-of-contents__link toc-highlight">Types of Visibility Callbacks</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#custom-visibility-percentage" class="table-of-contents__link toc-highlight">Custom visibility percentage</a></li></ul></li><li><a href="#changing-lithoview-visibility" class="table-of-contents__link toc-highlight">Changing LithoView Visibility</a><ul><li><a href="#litholifecycleprovider-api" class="table-of-contents__link toc-highlight">LithoLifecycleProvider API</a></li><li><a href="#android-aosp-implementation" class="table-of-contents__link toc-highlight">Android AOSP implementation</a></li><li><a href="#handling-custom-state-changes" class="table-of-contents__link toc-highlight">Handling custom state changes</a></li><li><a href="#nested-component-trees" class="table-of-contents__link toc-highlight">Nested Component Trees</a></li></ul></li><li><a href="#deprecated-setvisibilityhint" class="table-of-contents__link toc-highlight">(Deprecated) setVisibilityHint</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing/">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c0c9427e.js"></script>
<script src="/assets/js/main.4058c681.js"></script>
</body>
</html>