---
id: testing-actions
title: Interactions
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import VersionedCodeBlock from '@theme/VersionedCodeBlock';

An `Interaction` is defined as any type of action that a user can perform on `Components`. A good example is touching or clicking a `Button`.

## `act{InteractionsScope.() -> Unit}`

Currently, in `Litho`, the state of the `Components` is updated asynchronously, off the Main Thread. Once the background operations are finished, they are posted to the Main Thread to update the `Component`.

During tests, it's important to ensure that everything is in sync in Main Thread and in the Background Thread, just like in a real-life use case. This is the role of the `act{}` function, which removes the responsibility from you to use the Loopers and manage the thread synchronisation (see the following snippet). You only need to call one of the defined interactions from `InteractionsScope` and Litho takes care of the rest.

```kotlin file=litho-core-kotlin/src/test/kotlin/com/facebook/litho/examples/LithoViewRuleExampleTest.kt start=act_example_start end=act_example_end
```

The following interactions are exposed via `act()`:

* `clickOnText`
* `clickOnTag`
* `clickOnContentDescription`
* `clickOnRootView`

You can chain interactions to invoke multiples in a given order:

```kotlin
 lithoViewRule
        .act { clickOnText("Menu") }
        .act { clickOnText("File") }
        .act { clickOnText("New") }
        .act { clickOnText("New Project...") }
```

## `idle()`

You should use `act()` for events that trigger async updates (such as `clicks`).

Otherwise, there are sometimes async events triggered by layout (for example visibility events, or when you immediately update the state in render call) that you can manually wait for to finish by calling: `idle()`.

For example, you may need to do this if your component defines a visibility event that triggers an async state update. In such a case, `idle()` should be called after layout to make sure the update is reflected in the UI before making test assertions:

```kotlin file=litho-core-kotlin/src/test/kotlin/com/facebook/litho/examples/LithoViewRuleExampleTest.kt start=idle_component_start end=idle_component_end
```

## Interactions with LithoViewRule

### How to test click action

Four types of 'click' are supported:

* `clickOnText`
* `clickOnTag`
* `clickOnContentDescription`
* `clickOnRootView`

In order to test the click interaction, use a `TestComponent` that shows or hides the Text after the click action is performed on a `Row`:

```kotlin file=litho-core-kotlin/src/test/kotlin/com/facebook/litho/examples/LithoViewRuleExampleTest.kt start=component_for_action_start end=component_for_action_end
```

The test case performs three steps:

1. Confirm that the `Component` is not being rendered if we didn't click on the `Row`.
   * In order to do this, find the `Component` based on the Text or its Class by using either: `findViewWithTextOrNull(String)` or `findComponent(Class<out Component?>)` and assert that it's null.

2. Perform an action on our `LithoView` with the help of `LithoViewRule.act{}`.
   * Clicking on the content description of the row triggers the state update.

3. Confirm that the `Component` is being rendered and iYous not null.
   * You can use any of the available methods to just find the `Component`.

```kotlin file=litho-core-kotlin/src/test/kotlin/com/facebook/litho/examples/LithoViewRuleExampleTest.kt start=test_interaction_start end=test_interaction_end
```

### How to test `VisiblityEvent`

In order to test `VisiblityEvent` instead of using `LithoViewRule.render(Component)`, separate the methods that are being called under the render call.

This enables you check the state of the component before and after the visibility event is triggered:

```kotlin file=litho-core-kotlin/src/test/kotlin/com/facebook/litho/examples/LithoViewRuleExampleTest.kt start=visibility_test_start end=visibility_test_end
```

:::note
If there is any background work happening in your `onVisible` call, remember to call `idle()` after `layout()`.
:::

### How to test State Update

If you want to test a state update, the best thing to do is to trigger the event that causes the state update, as the state of the `Component` is not being exposed.
Take a look at the code example [above](#how-to-test-click-action) in the `clicking` section, where the State Update is triggered by the `Click Action`.
