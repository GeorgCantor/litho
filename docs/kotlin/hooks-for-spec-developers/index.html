<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Introducing Hooks for State | Litho</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/kotlin/hooks-for-spec-developers/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Introducing Hooks for State | Litho"><meta data-react-helmet="true" name="description" content="This page covers how to convert existing code from lifecycle methods in the Java Specs API to hooks in the Kotlin API. Please refer to this page for the main Hooks docs."><meta data-react-helmet="true" property="og:description" content="This page covers how to convert existing code from lifecycle methods in the Java Specs API to hooks in the Kotlin API. Please refer to this page for the main Hooks docs."><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/kotlin/hooks-for-spec-developers/"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/kotlin/hooks-for-spec-developers/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/kotlin/hooks-for-spec-developers/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.500f1454.css">
<link rel="preload" href="/assets/js/runtime~main.9d29b1be.js" as="script">
<link rel="preload" href="/assets/js/main.ddc73d99.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="color:#091E42" role="banner"><div class="announcementBarContent_3EUC">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine">Help Provide Humanitarian Aid to Ukraine</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation/">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview/">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">Introducing Hooks for State</h1></header><div class="markdown"><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><strong>This page covers how to convert existing code from lifecycle methods in the Java Specs API to hooks in the Kotlin API.</strong> Please refer to this <strong><a href="/docs/mainconcepts/hooks-intro/">page</a></strong> for the main Hooks docs.</p></div></div><p>One of the biggest changes in the Litho Kotlin API is the introduction of hooks: most of the APIs implemented with lifecycle methods in the Java Specs API (such as @OnCreateInitialState and @OnAttached) have hooks equivalents in the Kotlin API.</p><p>To familiarize yourself with the concept and rules for hooks, see the <a href="/docs/mainconcepts/hooks-intro/">Introduction to Hooks</a> page.</p><p>This page covers some of the main hooks and how they compare to their Spec API equivalents.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="usestate"><a href="/docs/mainconcepts/use-state/"><code>useState</code></a><a aria-hidden="true" class="hash-link" href="#usestate" title="Direct link to heading">â€‹</a></h2><p><code>useState</code> allows a component to persist a variable across renders and replaces the <code>@State</code>, <code>@OnCreateInitialState</code>, and <code>@OnUpdateState</code> APIs. The code below shows a comparison of Spec API and Kotlin API code for the same component:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Kotlin</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Java</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class CheckboxComponent : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component? {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val isChecked = useState { false }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column(style = Style.onClick { isChecked.update { currValue -&gt; !currValue } }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Image(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              drawable =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  drawableRes(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      if (isChecked.value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        android.R.drawable.checkbox_on_background</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        android.R.drawable.checkbox_off_background</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      })))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CheckboxComponentSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c, @State boolean isChecked) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Image.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .drawableRes(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    isChecked</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ? android.R.drawable.checkbox_on_background</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        : android.R.drawable.checkbox_off_background))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clickHandler(CheckboxComponent.onCheckboxClicked(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnUpdateState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void updateCheckbox(StateValue&lt;Boolean&gt; isChecked) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isChecked.set(!isChecked.get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(ClickEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onCheckboxClicked(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CheckboxComponent.updateCheckbox(c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="side-effects-in-oncreateinitialstate">Side Effects in <code>@OnCreateInitialState</code><a aria-hidden="true" class="hash-link" href="#side-effects-in-oncreateinitialstate" title="Direct link to heading">â€‹</a></h3><p>A common pattern in the Java Spec API was to perform side effects in <code>@OnCreateInitialState</code> (such as attaching a listener). Instead, any side effects like this should now be done with the <a href="/docs/mainconcepts/use-effect/">useEffect Hook</a>, which provides functionality to clean up and handle prop changes.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="useeffect"><a href="/docs/mainconcepts/use-effect/"><code>useEffect</code></a><a aria-hidden="true" class="hash-link" href="#useeffect" title="Direct link to heading">â€‹</a></h2><p>The <code>useEffect</code> hook gives the ability to safely perform side-effects from a component and corresponds to the Java Spec API&#x27;s <code>@OnAttached</code>/<code>@OnDetached</code> lifecycle methods.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">useEffect(username) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  println(&quot;I&#x27;ve been attached with prop $username!&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  onCleanup { println(&quot;I&#x27;ve been detached with prop $username!&quot;) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In addition to the existing <code>@OnAttached</code>/<code>@OnDetached</code> functionality, it provides the ability to perform side-effects in response to changes in committed props or state. Both the effect lambda and the cleanup lambda are invoked on the main thread, meaning it&#x27;s safe to perform UI-thread confined side effects.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="changes-to-attachdetach-contract">Changes to Attach/Detach Contract<a aria-hidden="true" class="hash-link" href="#changes-to-attachdetach-contract" title="Direct link to heading">â€‹</a></h3><p>In the Java Spec API, <code>@OnAttached</code>/<code>@OnDetached</code> would be called only once, when the component was first attached to/detached from the tree. This could lead to bugs where, for example, your component subscribes to a data store using a userId prop, and then that prop changes.</p><p><code>useEffect</code> tries to solve this by taking a var-arg list of <em>dependencies</em>: any time any of these dependencies changes, the cleanup lambda (previously <code>@OnDetached</code>) will be called followed by the new effect lambda. If no dependencies are provided, the previous cleanup and new effect lambdas will be invoked again <strong>every time a new layout is committed</strong>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="listening-to-propstate-changes">Listening to Prop/State Changes<a aria-hidden="true" class="hash-link" href="#listening-to-propstate-changes" title="Direct link to heading">â€‹</a></h3><p>An important functionality that <code>useEffect</code> adds over <code>@OnAttached</code>/<code>@OnDetached</code> is the ability to trigger code when props/state change. For example, this can be used to trigger an animation as a side-effect whenever some prop changes:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class AnimatingCounter(private val count: Int) : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component? {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val animation = useRef&lt;AnimatedAnimation?&gt; { null }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val translationY = useBinding(0f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    useEffect(count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Animate the text to a Y-offset based on count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val newAnimation = Animated.spring(translationY, to = count * 10.dp.toPixels().toFloat())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      newAnimation.start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      animation.value = newAnimation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      onCleanup { animation.value?.cancel() }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Text(style = Style.translationY(translationY), text = &quot;$count&quot;, textSize = 24.sp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="useref"><a href="/docs/mainconcepts/use-ref/"><code>useRef</code></a><a aria-hidden="true" class="hash-link" href="#useref" title="Direct link to heading">â€‹</a></h2><p>The <code>useRef</code> hook allows a component to maintain a mutable reference that doesn&#x27;t trigger a re-render when updated.</p><p>It returns an instance of <code>Ref</code> which has a single mutable <code>value</code> property which should only be read/written on the UI thread. <code>useRef</code> can be used as a replacement for <a href="/docs/codegen/state-for-specs/#lazy-state-updates">lazy state</a> from the Spec API, though it has more uses beyond that.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="example-logging-seen-state">Example: Logging Seen State<a aria-hidden="true" class="hash-link" href="#example-logging-seen-state" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class LogOnceComponent : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val hasLoggedVisible = useRef&lt;Boolean&gt; { false }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Text(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        style =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Style.onVisible {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              // onVisible executes on the main thread, so it&#x27;s safe to read/write hasLoggedVisible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              if (!hasLoggedVisible.value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                doLogVisible(androidContext)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hasLoggedVisible.value = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        text = &quot;I&#x27;ll let you know when I&#x27;m visible, but only once!&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="useerrorboundary"><a href="/docs/mainconcepts/use-error-boundary/"><code>useErrorBoundary</code></a><a aria-hidden="true" class="hash-link" href="#useerrorboundary" title="Direct link to heading">â€‹</a></h2><p>The <code>useErrorBoundary</code> hook allows KComponents to catch and handle errors higher up in the tree and provide appropriate fallback, logging or retry mechanisms. It corresponds to the Java Spec API&#x27;s <code>@OnError</code> functionality.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="example-providing-an-error-state-in-ui">Example: Providing an Error State in UI<a aria-hidden="true" class="hash-link" href="#example-providing-an-error-state-in-ui" title="Direct link to heading">â€‹</a></h3><p>A KComponent becomes an error boundary when it declares a <code>useErrorBoundary</code> hook. The example below shows how the implementation of a boundary that renders an error state compares between the Java Spec API and the Kotlin API:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Kotlin</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Java</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class KErrorBoundary(private val childComponent: Component) : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component? {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val errorState = useState&lt;Exception?&gt; { null }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    useErrorBoundary { exception: Exception -&gt; errorState.update(exception) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errorState.value?.let {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return Column(style = Style.margin(all = 16.dp)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        child(KDebugComponent(message = &quot;KComponent&#x27;s Error Boundary&quot;, throwable = it))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return childComponent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ErrorBoundarySpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentContext c, @Prop Component child, @State @Nullable Exception error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (error != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return DebugErrorComponent.create(c).message(&quot;Error Boundary&quot;).throwable(error).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return child;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnUpdateState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void updateError(StateValue&lt;Exception&gt; error, @Param Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error.set(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onError(ComponentContext c, Exception error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ErrorBoundary.updateErrorSync(c, error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><p>Check out the main <a href="/docs/mainconcepts/use-error-boundary/"><code>useErrorBoundary</code></a> for more detailed information.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="usetransition"><code>useTransition</code><a aria-hidden="true" class="hash-link" href="#usetransition" title="Direct link to heading">â€‹</a></h2><p><code>useTransition</code> registers a transition to be applied when the current layout is committed. It corresponds to the Java Spec API&#x27;s <code>@OnCreateTransition</code> functionality.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Kotlin</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Java</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class TransitionComponent : KComponent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun ComponentScope.render(): Component? {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val isHalfAlpha = useState { false }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    useTransition(Transition.create(&quot;square&quot;).animate(AnimatedProperties.ALPHA))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column(style = Style.onClick { isHalfAlpha.update(!isHalfAlpha.value) }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Row(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              style =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  Style.backgroundColor(Color.YELLOW)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      .width(80.dp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      .height(80.dp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      .alpha(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          if (isHalfAlpha.value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            0.5f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            1.0f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      .transitionKey(context, &quot;square&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AlphaTransitionComponentSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private static final String SQUARE_KEY = &quot;square&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c, @State boolean isHalfAlpha) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clickHandler(AlphaTransitionComponent.onClickEvent(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Row.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .backgroundColor(Color.YELLOW)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .widthDip(80)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .heightDip(80)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .alpha(isHalfAlpha ? 0.5f : 1.0f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .transitionKey(SQUARE_KEY))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateTransition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Transition onCreateTransition(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Transition.create(SQUARE_KEY).animate(AnimatedProperties.ALPHA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(ClickEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onClickEvent(ComponentContext c, @FromEvent View view) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AlphaTransitionComponent.onUpdateState(c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnUpdateState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onUpdateState(StateValue&lt;Boolean&gt; isHalfAlpha) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isHalfAlpha.set(!isHalfAlpha.get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/kotlin/hooks-for-spec-developers.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#usestate" class="table-of-contents__link toc-highlight">useState</a><ul><li><a href="#side-effects-in-oncreateinitialstate" class="table-of-contents__link toc-highlight">Side Effects in <code>@OnCreateInitialState</code></a></li></ul></li><li><a href="#useeffect" class="table-of-contents__link toc-highlight">useEffect</a><ul><li><a href="#changes-to-attachdetach-contract" class="table-of-contents__link toc-highlight">Changes to Attach/Detach Contract</a></li><li><a href="#listening-to-propstate-changes" class="table-of-contents__link toc-highlight">Listening to Prop/State Changes</a></li></ul></li><li><a href="#useref" class="table-of-contents__link toc-highlight">useRef</a><ul><li><a href="#example-logging-seen-state" class="table-of-contents__link toc-highlight">Example: Logging Seen State</a></li></ul></li><li><a href="#useerrorboundary" class="table-of-contents__link toc-highlight">useErrorBoundary</a><ul><li><a href="#example-providing-an-error-state-in-ui" class="table-of-contents__link toc-highlight">Example: Providing an Error State in UI</a></li></ul></li><li><a href="#usetransition" class="table-of-contents__link toc-highlight"><code>useTransition</code></a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing/">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9d29b1be.js"></script>
<script src="/assets/js/main.ddc73d99.js"></script>
</body>
</html>